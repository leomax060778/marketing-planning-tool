--changes to L5
ALTER TABLE "PLANNING_TOOL"."HL5" ADD ("ROUTE_TO_MARKET_ID" BIGINT);
ALTER TABLE "PLANNING_TOOL"."HL5" ADD ("VENUE" NVARCHAR(255));
ALTER TABLE "PLANNING_TOOL"."HL5" ADD ("CITY" NVARCHAR(255));
ALTER TABLE "PLANNING_TOOL"."HL5" ADD ("COUNTRY" NVARCHAR(255));
ALTER TABLE "PLANNING_TOOL"."HL5" ADD ("URL" NVARCHAR(255));
ALTER TABLE "PLANNING_TOOL"."HL5" ADD ("SALES_ORGANIZATION_ID" BIGINT);

ALTER TABLE "PLANNING_TOOL"."HL5" ADD ("PLANNED_START_DATE" timestamp);
ALTER TABLE "PLANNING_TOOL"."HL5" ADD ("PLANNED_END_DATE" timestamp);
ALTER TABLE "PLANNING_TOOL"."HL5" ADD ("STREET" NVARCHAR(255));
ALTER TABLE "PLANNING_TOOL"."HL5" ADD ("POSTAL_CODE" NVARCHAR(20));

--change to Hl4 category option
ALTER TABLE "PLANNING_TOOL"."HL4_CATEGORY_OPTION" ADD ("UPDATED" TINYINT DEFAULT 0);

--change to Hl4 category option
ALTER TABLE "PLANNING_TOOL"."HL5_CATEGORY_OPTION" ADD ("UPDATED" TINYINT DEFAULT 0);


--changes to campaign type
ALTER TABLE "PLANNING_TOOL"."CAMPAIGN_TYPE" ADD ("SHOW_ADDITIONAL_FIELDS" TINYINT DEFAULT 0);

-- set PHYSICAL EVENT CAMPAIGN TYPES to 1
UPDATE "PLANNING_TOOL"."CAMPAIGN_TYPE" SET SHOW_ADDITIONAL_FIELDS = 1
WHERE NAME = 'Physical Events - Featured' OR NAME = 'Physical Events - General';


--changes to L6
ALTER TABLE "PLANNING_TOOL"."HL6" ADD ("DISTRIBUTION_CHANNEL_ID" BIGINT NULL);
ALTER TABLE "PLANNING_TOOL"."HL6" ADD ("VENUE" NVARCHAR(255));
ALTER TABLE "PLANNING_TOOL"."HL6" ADD ("CITY" NVARCHAR(255));
ALTER TABLE "PLANNING_TOOL"."HL6" ADD ("COUNTRY" NVARCHAR(255));
ALTER TABLE "PLANNING_TOOL"."HL6" ADD ("URL" NVARCHAR(255));
ALTER TABLE "PLANNING_TOOL"."HL6" ADD ("RESULTS_CAMPAIGN_Q1" decimal(19,2) not null DEFAULT 0);
ALTER TABLE "PLANNING_TOOL"."HL6" ADD ("RESULTS_CAMPAIGN_Q2" decimal(19,2) not null DEFAULT 0);
ALTER TABLE "PLANNING_TOOL"."HL6" ADD ("RESULTS_CAMPAIGN_Q3" decimal(19,2) not null DEFAULT 0);
ALTER TABLE "PLANNING_TOOL"."HL6" ADD ("RESULTS_CAMPAIGN_Q4" decimal(19,2) not null DEFAULT 0);

ALTER TABLE "PLANNING_TOOL"."HL6" ADD ("PLANNED_START_DATE" timestamp);
ALTER TABLE "PLANNING_TOOL"."HL6" ADD ("PLANNED_END_DATE" timestamp);
ALTER TABLE "PLANNING_TOOL"."HL6" ADD ("STREET" NVARCHAR(255));
ALTER TABLE "PLANNING_TOOL"."HL6" ADD ("POSTAL_CODE" NVARCHAR(20));

--CREATE TABLES
CREATE COLUMN TABLE "PLANNING_TOOL"."MARKETING_PROGRAM" (
        "MARKETING_PROGRAM_ID" bigint not null primary key generated by default as IDENTITY,
        "NAME" NVARCHAR(100) NOT NULL,

        "CREATED_DATE_TZ" timestamp default CURRENT_TIMESTAMP,
        "MODIFIED_DATE_TZ" timestamp,
        "CREATED_USER_ID" bigint not null,
        "MODIFIED_USER_ID" bigint,
        "ENABLED" tinyint default 1,
        "DELETED" tinyint default 0,

        FOREIGN KEY ("CREATED_USER_ID") REFERENCES "PLANNING_TOOL"."USER"("USER_ID")
);

CREATE COLUMN TABLE "PLANNING_TOOL"."MARKETING_ACTIVITY" (
        "MARKETING_ACTIVITY_ID" bigint not null primary key generated by default as IDENTITY,
        "NAME" NVARCHAR(100) NOT NULL,

        "CREATED_DATE_TZ" timestamp default CURRENT_TIMESTAMP,
        "MODIFIED_DATE_TZ" timestamp,
        "CREATED_USER_ID" bigint not null,
        "MODIFIED_USER_ID" bigint,
        "ENABLED" tinyint default 1,
        "DELETED" tinyint default 0,

        FOREIGN KEY ("CREATED_USER_ID") REFERENCES "PLANNING_TOOL"."USER"("USER_ID")
);


----- Support categories and options in L6

CREATE COLUMN TABLE "PLANNING_TOOL"."HL6_CATEGORY" (
        HL6_CATEGORY_ID  bigint not null primary key generated by default as IDENTITY,
        HL6_ID BIGINT NOT NULL,
        CATEGORY_ID BIGINT NOT NULL,
        IN_PROCESSING_REPORT TINYINT DEFAULT 0,
        created_date_tz timestamp default CURRENT_TIMESTAMP,
        modified_date_tz timestamp,
        created_user_id bigint not null,
        modified_user_id bigint,
        enabled tinyint default 1,
        deleted tinyint default 0,
        FOREIGN KEY ("HL6_ID") REFERENCES "PLANNING_TOOL"."HL6"("HL6_ID"),
        FOREIGN KEY ("CREATED_USER_ID") REFERENCES "PLANNING_TOOL"."USER"("USER_ID"),
        FOREIGN KEY ("CATEGORY_ID") REFERENCES "PLANNING_TOOL"."CATEGORY"("CATEGORY_ID")
);


CREATE COLUMN TABLE "PLANNING_TOOL"."HL6_CATEGORY_OPTION" (
        HL6_CATEGORY_OPTION_ID bigint not null primary key generated by default as IDENTITY,
        HL6_CATEGORY_ID BIGINT NOT NULL,
        OPTION_ID BIGINT NOT NULL,
        AMOUNT DECIMAL(19,2) NOT NULL,
        created_date_tz timestamp default CURRENT_TIMESTAMP,
        modified_date_tz timestamp,
        created_user_id bigint not null,
        modified_user_id bigint,
        enabled tinyint default 1,
        deleted tinyint default 0,
        updated tinyint default 0,
        FOREIGN KEY ("HL6_CATEGORY_ID") REFERENCES "PLANNING_TOOL"."HL6_CATEGORY"("HL6_CATEGORY_ID"),
        FOREIGN KEY ("CREATED_USER_ID") REFERENCES "PLANNING_TOOL"."USER"("USER_ID"),
        FOREIGN KEY ("OPTION_ID") REFERENCES "PLANNING_TOOL"."OPTION"("OPTION_ID")
);

--GET CONSTRAINT FROM HL3
--execute--  SELECT TOP 1 CONSTRAINT_NAME from "SYS"."REFERENTIAL_CONSTRAINTS" WHERE TABLE_NAME='HL3';
--DELETE CONSTRAINT
--execute--  ALTER TABLE "HL3" DROP CONSTRAINT "_SYS_CONSTRAINT_174428_#490_#F0";
--CLEAN TABLE
-- exceute-- DELETE FROM BUSINESS_OWNER;
--INSERT NEW VALUES
-- exceute-- INSERT INTO BUSINESS_OWNER(DESCRIPTION,CREATED_USER_ID) VALUES('Marketing',1);
    -- exceute-- INSERT INTO BUSINESS_OWNER(DESCRIPTION,CREATED_USER_ID) VALUES('Sales',1);
-- exceute-- INSERT INTO BUSINESS_OWNER(DESCRIPTION,CREATED_USER_ID) VALUES('Demand Center',1);

--Changing DECIMALs to DECIMAL(19, 6)

ALTER TABLE "PLANNING_TOOL"."HL4_BUDGET_REGION" ALTER ( "PERCENTAGE" DECIMAL(19,6) );
ALTER TABLE "PLANNING_TOOL"."HL4_BUDGET_ROUTE" ALTER ( "PERCENTAGE" DECIMAL(19,6) );
ALTER TABLE "PLANNING_TOOL"."HL4_BUDGET_SUBREGION" ALTER ( "PERCENTAGE" DECIMAL(19,6) );
ALTER TABLE "PLANNING_TOOL"."HL4_EXPECTED_OUTCOMES_DETAIL" ALTER ( "EURO_VALUE" DECIMAL(19,6) NOT NULL DEFAULT 0, "AMOUNT_VALUE" DECIMAL(19,6) NOT NULL DEFAULT 0 );
ALTER TABLE "PLANNING_TOOL"."HL4_SALE_OTHER" ALTER ( "AMOUNT" DECIMAL(19,6) );
ALTER TABLE "PLANNING_TOOL"."HL4_SALE_OTHER_REGION" ALTER ( "AMOUNT" DECIMAL(19,6) );
ALTER TABLE "PLANNING_TOOL"."HL4_SALE_OTHER_SUBREGION" ALTER ( "AMOUNT" DECIMAL(19,6) );
ALTER TABLE "PLANNING_TOOL"."HL4_SALE_REGION" ALTER ( "AMOUNT" DECIMAL(19,6) );
ALTER TABLE "PLANNING_TOOL"."HL4_SALE_ROUTE" ALTER ( "AMOUNT" DECIMAL(19,6) );
ALTER TABLE "PLANNING_TOOL"."HL6_PARTNER" ALTER ( "VALUE" DECIMAL(19,6) );
ALTER TABLE "PLANNING_TOOL"."HL5_PARTNER" ALTER ( "VALUE" DECIMAL(19,6) );
ALTER TABLE "PLANNING_TOOL"."HL6_SALES" ALTER ( "AMOUNT" DECIMAL(19,6) );
ALTER TABLE "PLANNING_TOOL"."HL5_SALES" ALTER ( "AMOUNT" DECIMAL(19,6) );
ALTER TABLE "PLANNING_TOOL"."HL4_SALE_SUBREGION" ALTER ( "AMOUNT" DECIMAL(19,6) );
ALTER TABLE "PLANNING_TOOL"."HL6_EXPECTED_OUTCOMES_DETAIL" ALTER ( "EURO_VALUE" DECIMAL(19,6) NOT NULL DEFAULT 0, "VOLUME_VALUE" DECIMAL(19,6) NOT NULL DEFAULT 0 );
ALTER TABLE "PLANNING_TOOL"."INTERLOCK_REQUEST" ALTER ( "REQUESTED_BUDGET" DECIMAL(19,6) NULL );

-- Alter precision of euroConversions (different to rest of tables because it is originally above 19, 6)
ALTER TABLE "PLANNING_TOOL"."EURO_CONVERSIONS" ADD ( "CURRENCY_VALUE2" DECIMAL(19,6) NULL );
UPDATE "PLANNING_TOOL"."EURO_CONVERSIONS" SET "CURRENCY_VALUE2" = "CURRENCY_VALUE";
ALTER TABLE "PLANNING_TOOL"."EURO_CONVERSIONS" DROP ( "CURRENCY_VALUE");
RENAME COLUMN "PLANNING_TOOL"."EURO_CONVERSIONS"."CURRENCY_VALUE2" TO "CURRENCY_VALUE";
ALTER TABLE "PLANNING_TOOL"."EURO_CONVERSIONS" ALTER ( "CURRENCY_VALUE" DECIMAL(19,6) NOT NULL );



-- *************************************************************************************
-- Update schema version
INSERT INTO SCHEMA_VERSION(VERSION, DESCRIPTION, SCRIPT) 
VALUES('V5.0.0-09', 'Extend Data fields to Level 5 and Level 6', 'V201612201045__ExtendData_Level5_Level6.sql');

COMMIT;