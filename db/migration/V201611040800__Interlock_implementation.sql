DELETE FROM "PLANNING_TOOL"."INTERLOCK_STATUS";

INSERT INTO "PLANNING_TOOL"."INTERLOCK_STATUS"(INTERLOCK_STATUS_ID, NAME, DISPLAY_NAME, CREATED_USER_ID) 
VALUES(1, 'no_response', 'No Response', 1);

INSERT INTO "PLANNING_TOOL"."INTERLOCK_STATUS"(INTERLOCK_STATUS_ID, NAME, DISPLAY_NAME, CREATED_USER_ID) 
VALUES(2, 'Approved', 'Approved', 1);

INSERT INTO "PLANNING_TOOL"."INTERLOCK_STATUS"(INTERLOCK_STATUS_ID, NAME, DISPLAY_NAME, CREATED_USER_ID) 
VALUES(3, 'Rejected', 'Rejected', 1);

INSERT INTO "PLANNING_TOOL"."INTERLOCK_STATUS"(INTERLOCK_STATUS_ID, NAME, DISPLAY_NAME, CREATED_USER_ID) 
VALUES(4, 'Request Info', 'Request Info', 1);

UPDATE "PLANNING_TOOL"."INTERLOCK_ENTITY" SET NAME = 'Marketing Organizations' WHERE INTERLOCK_ENTITY_ID = 1;

INSERT INTO "PLANNING_TOOL"."INTERLOCK_ENTITY"(INTERLOCK_ENTITY_ID, NAME, CREATED_USER_ID) 
VALUES(2, 'Other', 1);

ALTER TABLE "PLANNING_TOOL"."INTERLOCK_REQUEST" DROP("HASH");

ALTER TABLE "PLANNING_TOOL"."INTERLOCK_REQUEST" DROP("SALT");

ALTER TABLE "PLANNING_TOOL"."INTERLOCK_REQUEST" DROP("REQUESTED_USER_ID");

ALTER TABLE "PLANNING_TOOL"."INTERLOCK_REQUEST" ADD ("REQUESTER_EMAIL" NVARCHAR(255));

ALTER TABLE "PLANNING_TOOL"."HL4" ADD ("REQUESTER_EMAIL" TI(255));

RENAME COLUMN "PLANNING_TOOL"."INTERLOCK_REQUEST_MESSAGE"."INTERLOCK_REQUEST_ID" TO "INTERLOCK_CONTACT_DATA_ID";

ALTER TABLE "PLANNING_TOOL"."LOG_INTERLOCK_REQUEST_STATUS" ADD ("REQUESTER_EMAIL" NVARCHAR(255));

CREATE COLUMN TABLE "PLANNING_TOOL"."INTERLOCK_CENTRAL_REGION_CONTACT_DATA" (
		"INTERLOCK_CENTRAL_REGION_CONTACT_DATA_ID" bigint not null primary key generated by default as IDENTITY,
        "BMO_LEADS" NVARCHAR(255),
        "EMPLOYEE_NUMBER" NVARCHAR(255),
        "EMAIL" NVARCHAR(255) NOT NULL,
        "CONTACT_TYPE" INT NOT NULL, -- 0 = CENTRAL TEAM - 1 = REGIONAL TEAM
        "CONTACT_TYPE_ID" BIGINT, --ID FROM REGIONAL OR CENTRAL TEAM
        
        
        "CREATED_DATE_TZ" timestamp default CURRENT_TIMESTAMP,
        "MODIFIED_DATE_TZ" timestamp,
        "CREATED_USER_ID" bigint not null,
        "MODIFIED_USER_ID" bigint,
        "ENABLED" tinyint default 1,
        "DELETED" tinyint default 0,

        FOREIGN KEY ("CREATED_USER_ID") REFERENCES "PLANNING_TOOL"."USER"("USER_ID")     
);

CREATE COLUMN TABLE "PLANNING_TOOL"."INTERLOCK_CONTACT_DATA" (
		"INTERLOCK_CONTACT_DATA_ID" bigint not null primary key generated by default as IDENTITY,
        "INTERLOCK_REQUEST_ID" bigint not null,       
        "EMAIL" NVARCHAR(255) NOT NULL,
        "HASH" NVARCHAR(255) NOT NULL,
        
        "CREATED_DATE_TZ" timestamp default CURRENT_TIMESTAMP,
        "MODIFIED_DATE_TZ" timestamp,
        "CREATED_USER_ID" bigint not null,
        "MODIFIED_USER_ID" bigint,
        "ENABLED" tinyint default 1,
        "DELETED" tinyint default 0,
        "SENDEMAIL"tinyint default 0,
        FOREIGN KEY ("CREATED_USER_ID") REFERENCES "PLANNING_TOOL"."USER"("USER_ID"), 
        FOREIGN KEY ("INTERLOCK_REQUEST_ID") REFERENCES "PLANNING_TOOL"."INTERLOCK_REQUEST"("INTERLOCK_REQUEST_ID")        
);

-- *************************************************************************************
-- Update schema version
INSERT INTO SCHEMA_VERSION(VERSION, DESCRIPTION, SCRIPT) 
VALUES('V5.0.0-01', 'Refactored FNC tables', 'V201611040800__Interlock_implementation.sql');

COMMIT;